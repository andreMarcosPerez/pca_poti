# ------------------------------------------------------------------------------
# -- @head: MECAI | MAI5002 | SVD Runtime --------------------------------------
# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------
# -- Clean ---------------------------------------------------------------------
# ------------------------------------------------------------------------------

rm(list=ls())
cat("\014")

# ------------------------------------------------------------------------------
# -- Variable ------------------------------------------------------------------
# ------------------------------------------------------------------------------

OUTPUT.FILE.NAME <- "svd_runtime_jacobi"

OUTPUT.PATH <- "../data/output/"
OUTPUT.FILE <- paste0(OUTPUT.FILE.NAME,".csv")

# ------------------------------------------------------------------------------
# -- Library -------------------------------------------------------------------
# ------------------------------------------------------------------------------

source("svd.R")

# ------------------------------------------------------------------------------
# -- Main ----------------------------------------------------------------------
# ------------------------------------------------------------------------------

set.seed(321)

matrix.size <- seq(from = 10, to = 1000, by = 10);
svd.runtime <- matrix(0, nrow = length(matrix.size), ncol = 2);

# ----------------------------------------
# -- Runtime -----------------------------
# ----------------------------------------

for (i in 1:length(matrix.size)) {
  
  svd.runtime[i,1] <- matrix.size[i];
  
  for (j in 1:10) {
    
    print(paste0(i, paste0(" | Matrix size = ", paste0(matrix.size[i], paste0(" | Repetition = ", j)))));
    
    random.matrix <- cov(replicate(matrix.size[i], rnorm(matrix.size[i])));
    runtime.start <- Sys.time();
    SVD.Jacobi(random.matrix, 1.e-5);
    svd.runtime[i,2] <- svd.runtime[i,2] + as.numeric(difftime(time1 = Sys.time(), time2 = runtime.start, units = "secs"));
    
  }
  
  svd.runtime[i,2] <- 0.1 * svd.runtime[i,2];
  
}

write.csv(x = svd.runtime,file = file.path(OUTPUT.PATH,OUTPUT.FILE));
