# ------------------------------------------------------------------------------
# -- @head: MECAI | MAI5002 | PCA ----------------------------------------------
# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------
# -- Clean ---------------------------------------------------------------------
# ------------------------------------------------------------------------------

rm(list=ls())
cat("\014")

# ------------------------------------------------------------------------------
# -- Library -------------------------------------------------------------------
# ------------------------------------------------------------------------------

source("svd.R")

# ------------------------------------------------------------------------------
# -- Variable ------------------------------------------------------------------
# ------------------------------------------------------------------------------

DATA.REL.PATH <- "../data/"
DATA.FILE     <- "facebook.csv"

# ------------------------------------------------------------------------------
# -- Function ------------------------------------------------------------------
# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------
# -- Main ----------------------------------------------------------------------
# ------------------------------------------------------------------------------

# ----------------------------------------
# -- Data --------------------------------
# ----------------------------------------

# -- Read

X <- read.csv(file.path(DATA.REL.PATH,DATA.FILE));
X <- X[, colSums(X != 0) > 0]
X <- t(X);

# -- Center + Normalize

for (i in 1:nrow(X)) {
  
  rowMean <- 0;
  
  for (j in 1:ncol(X)) {
    
    rowMean <- rowMean + X[i,j];
  }
  
  rowMean  <- (rowMean / ncol(X));
  
  if (rowMean != 0) {
    
    X[i,] <- (X[i,] - rowMean);
    X[i,] <- (X[i,] / max(X[i,]));
    
  }
}

# ----------------------------------------
# -- Covariance --------------------------
# ----------------------------------------

Sx <- (X %*% t(X)) / (ncol(X) - 1);

# ----------------------------------------
# -- Decomposition -----------------------
# ----------------------------------------

svd <- SVD(Sx, 1.e-5);

U <- svd$U;
S <- svd$S;
V <- svd$V;



